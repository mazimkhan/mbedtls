/* BEGIN_HEADER */
#include "mbedtls/xtea.h"
/* END_HEADER */

/* BEGIN_DEPENDENCIES
 * depends_on:MBEDTLS_XTEA_C
 * END_DEPENDENCIES
 */

/* BEGIN_CASE */
void xtea_encrypt_ecb( uint8_t * key_str, uint32_t key_str_len,
                       uint8_t * src_str, uint32_t src_str_len,
                       uint8_t * hex_dst_string, uint32_t hex_dst_string_len )
{
    unsigned char output[100];
    mbedtls_xtea_context ctx;

    memset(output, 0x00, 100);


    mbedtls_xtea_setup( &ctx, key_str );
    TEST_ASSERT( mbedtls_xtea_crypt_ecb( &ctx, MBEDTLS_XTEA_ENCRYPT, src_str, output ) == 0 );

    TEST_ASSERT( hexcmp( output, hex_dst_string, 8, hex_dst_string_len ) == 0 );
}
/* END_CASE */

/* BEGIN_CASE */
void xtea_decrypt_ecb( uint8_t * key_str, uint32_t key_str_len,
                       uint8_t * src_str, uint32_t src_str_len,
                       uint8_t * hex_dst_string, uint32_t hex_dst_string_len )
{
    unsigned char output[100];
    mbedtls_xtea_context ctx;

    memset(output, 0x00, 100);


    mbedtls_xtea_setup( &ctx, key_str );
    TEST_ASSERT( mbedtls_xtea_crypt_ecb( &ctx, MBEDTLS_XTEA_DECRYPT, src_str, output ) == 0 );

    TEST_ASSERT( hexcmp( output, hex_dst_string, 8, hex_dst_string_len ) == 0 );
}
/* END_CASE */

/* BEGIN_CASE depends_on:MBEDTLS_CIPHER_MODE_CBC */
void xtea_encrypt_cbc( uint8_t * key_str, uint32_t key_str_len,
                       uint8_t * iv_str, uint32_t iv_str_len,
                       uint8_t * src_str, uint32_t len,
                       uint8_t * hex_dst_string, uint32_t hex_dst_string_len )
{
    unsigned char output[100];
    mbedtls_xtea_context ctx;

    memset(output, 0x00, 100);


    mbedtls_xtea_setup( &ctx, key_str );
    TEST_ASSERT( mbedtls_xtea_crypt_cbc( &ctx, MBEDTLS_XTEA_ENCRYPT, len, iv_str,
                                 src_str, output ) == 0 );

    TEST_ASSERT( hexcmp( output, hex_dst_string, len, hex_dst_string_len ) == 0 );
}
/* END_CASE */

/* BEGIN_CASE depends_on:MBEDTLS_CIPHER_MODE_CBC */
void xtea_decrypt_cbc( uint8_t * key_str, uint32_t key_str_len,
                       uint8_t * iv_str, uint32_t iv_str_len,
                       uint8_t * src_str, uint32_t len,
                       uint8_t * hex_dst_string, uint32_t hex_dst_string_len )
{
    unsigned char output[100];
    mbedtls_xtea_context ctx;

    memset(output, 0x00, 100);


    mbedtls_xtea_setup( &ctx, key_str );
    TEST_ASSERT( mbedtls_xtea_crypt_cbc( &ctx, MBEDTLS_XTEA_DECRYPT, len, iv_str,
                                 src_str, output ) == 0 );

    TEST_ASSERT( hexcmp( output, hex_dst_string, len, hex_dst_string_len ) == 0 );
}
/* END_CASE */

/* BEGIN_CASE depends_on:MBEDTLS_SELF_TEST */
void xtea_selftest(  )
{
    TEST_ASSERT( mbedtls_xtea_self_test( 1 ) == 0 );
}
/* END_CASE */
